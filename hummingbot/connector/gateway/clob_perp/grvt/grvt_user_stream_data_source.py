import asyncio import json import aiohttp from typing import Optional from hummingbot.core.data_type.user_stream_tracker_data_source import UserStreamTrackerDataSource from hummingbot.connector.gateway.clob_perp.grvt import grvt_constants as constants from hummingbot.logger import HummingbotLogger  class GrvtUserStreamDataSource(UserStreamTrackerDataSource):     def __init__(self, auth):         self._auth = auth         super().__init__()      async def listen_for_user_stream(self, output: asyncio.Queue):         """         Connects to the private GRVT WebSocket to listen for user-specific events.         """         while True:             try:                 async with aiohttp.ClientSession() as session:                     # Authenticated WebSocket connection                     async with session.ws_connect(constants.GRVT_MAINNET_WS) as ws:                                                  # Authentication Payload                         auth_payload = self._auth.add_auth_to_params("GET", "/ws", {})                         login_request = {                             "method": "login",                             "params": auth_payload,                             "id": 1                         }                         await ws.send_str(json.dumps(login_request))                          # Subscribe to private channels                         subscribe_payload = {                             "method": "subscribe",                             "params": {"channel": constants.WS_USER_ORDERS_CHANNEL},                             "id": 2                         }                         await ws.send_str(json.dumps(subscribe_payload))                          async for msg in ws:                             if msg.type == aiohttp.WSMsgType.TEXT:                                 data = json.loads(msg.data)                                 # Send private data (fills, order updates) to the tracker                                 output.put_nowait(data)                             elif msg.type in (aiohttp.WSMsgType.CLOSED, aiohttp.WSMsgType.ERROR):                                 break             except asyncio.CancelledError:                 raise             except Exception as e:                 self.logger().error(f"Unexpected error in User Stream: {e}")                 await asyncio.sleep(5)
