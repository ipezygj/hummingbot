name: Gandalfs Bridge 2.0

on:
  workflow_dispatch:
    inputs:
      commit_message:
        description: 'Commit Message (Professional format: feat/fix/refactor)'
        required: true
        default: 'refactor: technical update and code optimization'
      files_json:
        description: 'JSON format: {"path/to/file.py": "code content", "path2.py": "code2"}'
        required: true

jobs:
  bridge_update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Update Multiple Files
        run: |
          echo '${{ github.event.inputs.files_json }}' > files.json
          python3 -c "
          import json, os
          with open('files.json') as f:
              data = json.load(f)
              for path, content in data.items():
                  os.makedirs(os.path.dirname(path), exist_ok=True)
                  with open(path, 'w') as out:
                      out.write(content)
          "
      
      - name: Commit and Push
        run: |
          git config --global user.name "Gandalfs Bridge"
          git config --global user.email "bridge@gandalf.ai"
          git add .
          git commit -m "${{ github.event.inputs.commit_message }}"
          git push
